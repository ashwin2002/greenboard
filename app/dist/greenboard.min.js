/*! greenboard 2015-11-20 */
!function(){"use strict";angular.module("plotly",[]).directive("plotly",["Data","PASS_BAR_STYLE","FAIL_BAR_STYLE","CHART_LAYOUT","CHART_OPTIONS",function(a,b,c,d,e){return{restrict:"E",template:"<div></div>",scope:{},link:function(f,g){var g=g[0].children[0],h=a.getVersionBuilds(),i=a.getBuild(),j=b,k=c,l=h.filter(function(a){return a.Passed+a.Failed>200});j.x=k.x=l.map(function(a){return a.build}),j.y=l.map(function(a){return a.Passed}),k.y=l.map(function(a){return a.Failed});var m=[j,k],n=e,o=d;o.title=a.getSelectedVersion()+"-"+i,Plotly.newPlot(g,m,o,n)}}}]).value("PASS_BAR_STYLE",{x:[],y:[],type:"bar",name:"Pass",marker:{color:"rgba(59, 201, 59, 0.70)"}}).value("FAIL_BAR_STYLE",{x:[],y:[],type:"bar",name:"Fail",marker:{color:"rgba(222, 0, 0, 0.70)"}}).value("CHART_LAYOUT",{height:300,width:800,title:""}).value("CHART_OPTIONS",{showLink:!1,displayLogo:!1})}();var app=angular.module("greenBoard",["plotly","ui.router","svc.data","svc.query","app.main","app.target"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/server/4.1.0/latest"),a.state("target",{url:"/:target","abstract":!0,template:"<ui-view/>",resolve:{target:["$stateParams",function(a){return a.target}],targetVersions:["$stateParams","Data","QueryService",function(a,b,c){var d=a.target,e=b.getTargetVersions(d);return e||(e=c.getVersions(d)),e}]}}).state("target.version",{url:"/:version/:build",templateUrl:"view.html",controller:"NavCtrl",resolve:{version:["$stateParams","$location","targetVersions","target",function(a,b,c,d){var e=a.version;return("latest"==e||-1==c.indexOf(e))&&(e=c[c.length-1],b.path(d+"/"+e)),e}],build:["$stateParams",function(a){return a.build}]}}).state("target.version.build",{templateUrl:"partials/builds.html",controller:"BuildCtrl",resolve:{versionBuilds:["QueryService","target","version",function(a,b,c){return a.getBuilds(b,c)}]}})}]),angular.module("svc.data",[]).provider("Data",[function(){this.versions=[],this.target="server",this.version=null,this.versions=[],this.build=null,this.builds=[],this.$get=function(){return _targetVersions={},{setTarget:function(a){this.target=a},setTargetVersions:function(a){this.target&&(_targetVersions[this.target]=a),this.versions=a},setSelectedVersion:function(a){this.version=a},setBuild:function(a){this.build=a},setVersionBuilds:function(a){this.builds=a},getCurrentTarget:function(){return this.target},getTargetVersions:function(a){var b=this.versions;return a&&(b=_targetVersions[a]),b},getSelectedVersion:function(){return this.version},getBuild:function(){return this.build},getVersionBuilds:function(){return this.builds}}}}]),angular.module("app.main",[]).controller("NavCtrl",["$scope","$state","$stateParams","Data","target","targetVersions","version",function(a,b,c,d,e,f,g){d.setTarget(e),d.setSelectedVersion(g),d.setTargetVersions(f),b.go("target.version.build"),a.changeTarget=function(a){b.go("target.version",{target:a,version:"latest"})},a.changeVersion=function(a){b.go("target.version",{version:a})}}]).controller("BuildCtrl",["$scope","build","versionBuilds","Data",function(a,b,c,d){d.setBuild(b),d.setVersionBuilds(c)}]),angular.module("svc.query",[]).service("QueryService",["$http","Data",function(a,b){return{getVersions:function(b){var c=["versions",b].join("/");return a({url:c,cache:!0}).then(function(a){return a.data})},getBuilds:function(b,c){var d=["builds",b,c].join("/");return a({url:d,cache:!0}).then(function(a){return a.data})}}}]),angular.module("app.target",[]).directive("targetSelector",["$state","ViewTargets","Data",function(a,b,c){return{restrict:"E",scope:{changeTarget:"="},templateUrl:"partials/targets.html",link:function(a,d,e){a.$watch(function(){return c.getCurrentTarget()},function(c){c&&(a.viewTargets=b.allTargets(),a.targetBy=b.getTarget(c))})}}}]).directive("versionSelector",["$stateParams","ViewTargets","QueryService","Data",function(a,b,c,d){return{restrict:"E",templateUrl:"partials/versions.html",scope:{changeVersion:"="},link:function(a,b,c){a.$watch(function(){return d.getSelectedVersion()},function(b){b&&(a.version=b,a.targetVersions=d.getTargetVersions())})}}}]).factory("ViewTargets",["COUCHBASE_TARGET","SDK_TARGET","MOBILE_TARGET",function(a,b,c){var d=[a,b,c],e={};return d=d.map(function(a,b){return a.i=b,e[a.bucket]=a,a}),{allTargets:function(){return d},getTarget:function(a){return e[a]}}}]).value("COUCHBASE_TARGET",{title:"Couchbase Server",bucket:"server",key:"abspassed",value:100,options:[0,50,100,500]}).value("SDK_TARGET",{title:"SDK",bucket:"sdk",key:"abspassed",value:100,options:[0,50,100,500]}).value("MOBILE_TARGET",{title:"Mobile",bucket:"mobile",key:"abspassed",value:0,options:[0,50,100,500]});